<?xml version="1.0" encoding="UTF-8"?><VIEWS_SPEC xmlns="http://www.metricstream.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.metricstream.com ms_application_schema.xsd">
<PLATFORM_DETAILS>
<PLATFORM_VERSION>6.1</PLATFORM_VERSION>
<BUILD_VERSION>5.4.2.0</BUILD_VERSION>
</PLATFORM_DETAILS>
<VIEW_NAME><![CDATA[MS_RGA_ISSUE_REPORT]]></VIEW_NAME>
<OBJECT_ID><![CDATA[MS_RGA_ISSUE_REPORT]]></OBJECT_ID>
<VIEW_TEXT><![CDATA[("ISSUE_TITLE_GRCI","CHANNEL_NAME_GRCI","ALERT_TITLE_GRCI","ISSUE_STATUS","ISSUE_OWNER_GRCI","ISSUE_RATING_GRCI","ISSUE_DUE_DATE_GRCI","ISSUE_TYPE_GRCI","ISSUE_DETAILS_GRCI","RECOMMENDATION_GRCI","OWNER_ORGANIZATION","APPROVER_ORGANIZATION","ISSUE_APPROVER_GRCI","ATTACHMENTS","BODY","ATTACHMENT","ISSUE_CREATED_BY","FEED_DATA_ID") AS SELECT T.ISSUE_TITLE_GRCI AS ISSUE_TITLE_GRCI,
    T.CHANNEL_NAME_GRCI     AS CHANNEL_NAME_GRCI,
    T.ALERT_TITLE_GRCI      AS ALERT_TITLE_GRCI,
    T1.ISSUE_STATUS         AS ISSUE_STATUS,
   ( CASE CONST.PARAMETER_VALUE
     WHEN '2'
      THEN OWNNAME.LAST_NAME || ' ' || OWNNAME.FIRST_NAME
      WHEN '3'
      THEN OWNNAME.LAST_NAME || ',' || ' ' || OWNNAME.FIRST_NAME || ' ' || '(' || OWNNAME.USER_NAME || ')'
      WHEN '1'
      THEN OWNNAME.FIRST_NAME|| ' ' || OWNNAME.LAST_NAME
      WHEN '4'
      THEN OWNNAME.FIRST_NAME|| ',' || ' ' || OWNNAME.LAST_NAME || ' ' || '(' || OWNNAME.USER_NAME || ')' 
      ELSE OWNNAME.LAST_NAME || ' ' || OWNNAME.FIRST_NAME  END ) AS ISSUE_OWNER_GRCI,

    --  (select ms_apps_utilities.get_user_full_name(T.ISSUE_OWNER_GRCI)  from dual)  AS ISSUE_OWNER_GRCI,
   -- DECODE(T.ISSUE_RATING_GRCI,1,'High',2,'Medium',3,'Low')                                    AS ISSUE_RATING_GRCI,
   -- MS_RGA_UTILITIES.GET_ISSUE_RATING(T.ISSUE_RATING_GRCI)                                     AS  ISSUE_RATING_GRCI,
   T.ISSUE_RATING_GRCI                                    						AS  ISSUE_RATING_GRCI,
    T.ISSUE_DUE_DATE_GRCI                                                                      AS ISSUE_DUE_DATE_GRCI,
    --MS_RGA_UTILITIES.get_ism_issue_type(T.ISSUE_TYPE_GRCI)                                     AS ISSUE_TYPE_GRCI,
 T.ISSUE_TYPE_GRCI							                                   AS ISSUE_TYPE_GRCI,
    TO_CHAR(T.ISSUE_DETAILS_GRCI)                                                              AS ISSUE_DETAILS_GRCI,
    TO_CHAR(T.RECOMMENDATION_GRCI)                                                             AS RECOMMENDATION_GRCI,
    --MS_RGA_UTILITIES.get_app_own_name(T.OWNER_ORG_GRCI)                                        AS OWNER_ORGANIZATION,
    --MS_RGA_UTILITIES.get_app_own_name(T.APPROVER_ORG_GRCI)                                     AS APPROVER_ORGANIZATION,
    OwnOrg.ORG_ENTITY_NAME                                        AS OWNER_ORGANIZATION,
    AprOrg.ORG_ENTITY_NAME                                    AS APPROVER_ORGANIZATION,
  --    (select ms_apps_utilities.get_user_full_name(T.ISSUE_APPROVER_GRCI) from dual) AS ISSUE_APPROVER_GRCI,
    ( CASE CONST.PARAMETER_VALUE
     WHEN '2'
      THEN APPNAME.LAST_NAME || ' ' || APPNAME.FIRST_NAME
      WHEN '3'
      THEN APPNAME.LAST_NAME || ',' || ' ' || APPNAME.FIRST_NAME || ' ' || '(' || APPNAME.USER_NAME || ')'
      WHEN '1'
      THEN APPNAME.FIRST_NAME|| ' ' || APPNAME.LAST_NAME
      WHEN '4'
      THEN APPNAME.FIRST_NAME|| ',' || ' ' || APPNAME.LAST_NAME || ' ' || '(' || APPNAME.USER_NAME || ')' 
      ELSE APPNAME.LAST_NAME || ' ' || APPNAME.FIRST_NAME  END ) AS ISSUE_APPROVER_GRCI,
    Null AS Attachments,
	T2.BODY       AS Body,
    ''''    || T2.attachment    || ''', 10' AS  Attachment,
    T.ISSUE_CREATED_BY,
	  T.FEED_DATA_ID
  FROM MS_RGA_LOG_ISSUES_V T,
    MS_ISM_INTEGRATION_PUB_V T1,
    MS_RGA_AGGREGATOR T2, SI_ORG_ENTITIES_T OwnOrg, SI_ORG_ENTITIES_T AprOrg, SI_USERS_T OWNNAME,SI_USERS_T APPNAME,
    (SELECT MIN(PVALUE.PARAMETER_VALUE) PARAMETER_VALUE
    FROM MS_QS_PARAMETER_VALUES PVALUE,
      MS_QS_PARAMETER_TYPES PTYPE,
      MS_QS_PARAMETER_NAMES PNAME
    WHERE UPPER (PTYPE.PARAMETER_TYPE) = 'MS APPS USER NAME DISPLAY FORMAT'
    AND PNAME.PARAMETER_ID             = PVALUE.PARAMETER_ID
    AND PTYPE.PARAMETER_TYPE_ID        = PVALUE.PARAMETER_TYPE_ID
    AND PTYPE.PARAMETER_TYPE_ID        = PNAME.PARAMETER_TYPE_ID
    AND UPPER (PNAME.PARAMETER_NAME)   = UPPER ('DISPLAY_FORMAT')
    AND PVALUE.ORG_ENTITY_ID           = 1
    ) CONST
   WHERE T.OBJECT_ID          IS NOT NULL
  AND T.FEED_DATA_ID = T2.FEED_DATA_ID
  AND T.INSTANCE_ID          IN
    (SELECT MAX(T2.INSTANCE_ID)
    FROM MS_RGA_LOG_ISSUES_V T2
    WHERE T2.OBJECT_ID = T.OBJECT_ID
    )
  AND T.OBJECT_ID          = T1.ISSUE_SOURCE_REF
  AND T.ISSUE_TITLE_GRCI   =T1.ISSUE_TITLE --added by murali
  AND T1.ISSUE_SOURCE_TYPE = 'GRC Intelligence'
  AND (T.Process_Instance_Id, T.Instance_Id) IN --added by murali
    (SELECT Process_Instance_Id,
      MAX(Instance_Id)
    FROM MS_RGA_LOG_ISSUES_V T1
    GROUP BY Process_Instance_Id
    )
  AND OwnOrg.ORG_ENTITY_ID=T.OWNER_ORG_GRCI  
  AND AprOrg.ORG_ENTITY_ID=T.APPROVER_ORG_GRCI
  AND OWNNAME.USER_NAME   = T.ISSUE_OWNER_GRCI
  AND OWNNAME.ENTERPRISE_ID = OWNNAME.ENTERPRISE_ID-- TO INVOKE THE INDEX ON SI_USERS_T
  AND APPNAME.USER_NAME   =ISSUE_APPROVER_GRCI
  --TO INVOKE THE INDEX ON SI_USERS_T
    AND APPNAME.ENTERPRISE_ID = APPNAME.ENTERPRISE_ID]]></VIEW_TEXT>
</VIEWS_SPEC>
