<!DOCTYPE html>
<html lang="en">
       <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>DB Programs and Objects</title>

        <!-- Bootstrap Core CSS -->
        <link href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- MetisMenu CSS -->
        <link href="../../bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

        <!-- DataTables CSS -->
        <link href="../../bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet">

        <!-- DataTables Responsive CSS -->
        <link href="../../bower_components/datatables-responsive/css/dataTables.responsive.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="../../dist/css/sb-admin-2.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="../../bower_components/fontawesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../../dist/css/jquery.mCustomScrollbar.css">
        <link href="../../dist/css/style.css" rel="stylesheet">
        <script src="../../js/jquery-1.11.1.min.js"></script>
        <script src="../../dist/js/selectAllJavaScript.js"></script>
        <style>
            html, body{ height: 100%; }
        </style>
    </head>

    <body>
        <div id="wrapper">
            <div id="page-wrapper">
                <div class="row">
                    <br/>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h4><span class="fa fa-table fa-fw"></span>  <a style="text-decoration: none; " id="MS_RGA_ISSUE_REPORT">MS_RGA_ISSUE_REPORT</a> </h4>
                            </div>
                            <div class="panel-body">
                                <div class="dataTable_wrapper">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="btn btn-primary" onclick="SelectText('selectme')">Select All</button>
                                            </div>
                                            <div class="modal-body" >
                                                <pre id="selectme">
                                                
  CREATE OR REPLACE FORCE VIEW "GRCIDEV"."MS_RGA_ISSUE_REPORT" ("ISSUE_TITLE_GRCI", "CHANNEL_NAME_GRCI", "ALERT_TITLE_GRCI", "ISSUE_STATUS", "ISSUE_OWNER_GRCI", "ISSUE_RATING_GRCI", "ISSUE_DUE_DATE_GRCI", "ISSUE_TYPE_GRCI", "ISSUE_DETAILS_GRCI", "RECOMMENDATION_GRCI", "OWNER_ORGANIZATION", "APPROVER_ORGANIZATION", "ISSUE_APPROVER_GRCI", "ATTACHMENTS", "BODY", "ATTACHMENT", "ISSUE_CREATED_BY", "FEED_DATA_ID") AS 
  SELECT T.ISSUE_TITLE_GRCI AS ISSUE_TITLE_GRCI,
    T.CHANNEL_NAME_GRCI     AS CHANNEL_NAME_GRCI,
    T.ALERT_TITLE_GRCI      AS ALERT_TITLE_GRCI,
    T1.ISSUE_STATUS         AS ISSUE_STATUS,
   ( CASE CONST.PARAMETER_VALUE
     WHEN '2'
      THEN OWNNAME.LAST_NAME || ' ' || OWNNAME.FIRST_NAME
      WHEN '3'
      THEN OWNNAME.LAST_NAME || ',' || ' ' || OWNNAME.FIRST_NAME || ' ' || '(' || OWNNAME.USER_NAME || ')'
      WHEN '1'
      THEN OWNNAME.FIRST_NAME|| ' ' || OWNNAME.LAST_NAME
      WHEN '4'
      THEN OWNNAME.FIRST_NAME|| ',' || ' ' || OWNNAME.LAST_NAME || ' ' || '(' || OWNNAME.USER_NAME || ')' 
      ELSE OWNNAME.LAST_NAME || ' ' || OWNNAME.FIRST_NAME  END ) AS ISSUE_OWNER_GRCI,

    --  (select ms_apps_utilities.get_user_full_name(T.ISSUE_OWNER_GRCI)  from dual)  AS ISSUE_OWNER_GRCI,
   -- DECODE(T.ISSUE_RATING_GRCI,1,'High',2,'Medium',3,'Low')                                    AS ISSUE_RATING_GRCI,
   -- MS_RGA_UTILITIES.GET_ISSUE_RATING(T.ISSUE_RATING_GRCI)                                     AS  ISSUE_RATING_GRCI,
   T.ISSUE_RATING_GRCI                                    						AS  ISSUE_RATING_GRCI,
    T.ISSUE_DUE_DATE_GRCI                                                                      AS ISSUE_DUE_DATE_GRCI,
    --MS_RGA_UTILITIES.get_ism_issue_type(T.ISSUE_TYPE_GRCI)                                     AS ISSUE_TYPE_GRCI,
 T.ISSUE_TYPE_GRCI							                                   AS ISSUE_TYPE_GRCI,
    TO_CHAR(T.ISSUE_DETAILS_GRCI)                                                              AS ISSUE_DETAILS_GRCI,
    TO_CHAR(T.RECOMMENDATION_GRCI)                                                             AS RECOMMENDATION_GRCI,
    --MS_RGA_UTILITIES.get_app_own_name(T.OWNER_ORG_GRCI)                                        AS OWNER_ORGANIZATION,
    --MS_RGA_UTILITIES.get_app_own_name(T.APPROVER_ORG_GRCI)                                     AS APPROVER_ORGANIZATION,
    OwnOrg.ORG_ENTITY_NAME                                        AS OWNER_ORGANIZATION,
    AprOrg.ORG_ENTITY_NAME                                    AS APPROVER_ORGANIZATION,
  --    (select ms_apps_utilities.get_user_full_name(T.ISSUE_APPROVER_GRCI) from dual) AS ISSUE_APPROVER_GRCI,
    ( CASE CONST.PARAMETER_VALUE
     WHEN '2'
      THEN APPNAME.LAST_NAME || ' ' || APPNAME.FIRST_NAME
      WHEN '3'
      THEN APPNAME.LAST_NAME || ',' || ' ' || APPNAME.FIRST_NAME || ' ' || '(' || APPNAME.USER_NAME || ')'
      WHEN '1'
      THEN APPNAME.FIRST_NAME|| ' ' || APPNAME.LAST_NAME
      WHEN '4'
      THEN APPNAME.FIRST_NAME|| ',' || ' ' || APPNAME.LAST_NAME || ' ' || '(' || APPNAME.USER_NAME || ')' 
      ELSE APPNAME.LAST_NAME || ' ' || APPNAME.FIRST_NAME  END ) AS ISSUE_APPROVER_GRCI,
    Null AS Attachments,
	T2.BODY       AS Body,
    ''''    || T2.attachment    || ''', 10' AS  Attachment,
    T.ISSUE_CREATED_BY,
	  T.FEED_DATA_ID
  FROM MS_RGA_LOG_ISSUES_V T,
    MS_ISM_INTEGRATION_PUB_V T1,
    MS_RGA_AGGREGATOR T2, SI_ORG_ENTITIES_T OwnOrg, SI_ORG_ENTITIES_T AprOrg, SI_USERS_T OWNNAME,SI_USERS_T APPNAME,
    (SELECT MIN(PVALUE.PARAMETER_VALUE) PARAMETER_VALUE
    FROM MS_QS_PARAMETER_VALUES PVALUE,
      MS_QS_PARAMETER_TYPES PTYPE,
      MS_QS_PARAMETER_NAMES PNAME
    WHERE UPPER (PTYPE.PARAMETER_TYPE) = 'MS APPS USER NAME DISPLAY FORMAT'
    AND PNAME.PARAMETER_ID             = PVALUE.PARAMETER_ID
    AND PTYPE.PARAMETER_TYPE_ID        = PVALUE.PARAMETER_TYPE_ID
    AND PTYPE.PARAMETER_TYPE_ID        = PNAME.PARAMETER_TYPE_ID
    AND UPPER (PNAME.PARAMETER_NAME)   = UPPER ('DISPLAY_FORMAT')
    AND PVALUE.ORG_ENTITY_ID           = 1
    ) CONST
   WHERE T.OBJECT_ID          IS NOT NULL
  AND T.FEED_DATA_ID = T2.FEED_DATA_ID
  AND T.INSTANCE_ID          IN
    (SELECT MAX(T2.INSTANCE_ID)
    FROM MS_RGA_LOG_ISSUES_V T2
    WHERE T2.OBJECT_ID = T.OBJECT_ID
    )
  AND T.OBJECT_ID          = T1.ISSUE_SOURCE_REF
  AND T.ISSUE_TITLE_GRCI   =T1.ISSUE_TITLE --added by murali
  AND T1.ISSUE_SOURCE_TYPE = 'GRC Intelligence'
  AND (T.Process_Instance_Id, T.Instance_Id) IN --added by murali
    (SELECT Process_Instance_Id,
      MAX(Instance_Id)
    FROM MS_RGA_LOG_ISSUES_V T1
    GROUP BY Process_Instance_Id
    )
  AND OwnOrg.ORG_ENTITY_ID=T.OWNER_ORG_GRCI  
  AND AprOrg.ORG_ENTITY_ID=T.APPROVER_ORG_GRCI
  AND OWNNAME.USER_NAME   = T.ISSUE_OWNER_GRCI
  AND OWNNAME.ENTERPRISE_ID = OWNNAME.ENTERPRISE_ID-- TO INVOKE THE INDEX ON SI_USERS_T
  AND APPNAME.USER_NAME   =ISSUE_APPROVER_GRCI
  --TO INVOKE THE INDEX ON SI_USERS_T
    AND APPNAME.ENTERPRISE_ID = APPNAME.ENTERPRISE_ID
                                                </pre>
                                            </div>
                                        </div>
                                        <!-- /.modal-content -->
                                    </div>
                                    <!-- /.modal-dialog -->
                                </div>
                                <!-- /.table-wrapper -->
                            </div>
                            <!-- /.panel-body -->
                        </div>
                        <!-- /.panel-info -->
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <!-- /row -->
            </div>
            <!-- /page wrapper -->
        </div>
        <!-- /.wrapper-->

                <!-- jQuery -->
        <script src="../../bower_components/jquery/dist/jquery.min.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

        <!-- Metis Menu Plugin JavaScript -->
        <script src="../../bower_components/metisMenu/dist/metisMenu.min.js"></script>

        <!-- DataTables JavaScript -->
        <script src="../../bower_components/DataTables/media/js/jquery.dataTables.min.js"></script>
        <script src="../../bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="../../dist/js/sb-admin-2.js"></script>

        <!-- Custom JS scripts for search capbility -->
        <script type="text/javascript" src="../../dist/js/searchsidemenujavascript.js"></script>

        <!-- Custom JS scripts for easy scrollbar -->
        <script src="../../dist/js/jquery.mCustomScrollbar.concat.min.js"></script>
        <link rel="stylesheet" href="../../dist/highlight/styles/sunburst.css"/>
        <script src="../../dist/highlight/highlight.pack.js"></script>

        <script>
            $(document).ready(function() {
                
            });
            $('#sciptModal').on('shown.bs.modal', function () {
                $("body").mCustomScrollbar("disable");
            });
            $('#sciptModal').on('hidden.bs.modal', function () {
                $("body").mCustomScrollbar("update");
            });
                        (function($){
                         function scrollBody(){
                        var referrer = document.URL;
                        var res = referrer.split("#");
                        var hashAddress="#"+res[1];
                        $("body").mCustomScrollbar('scrollTo',$("body").find(hashAddress));  
                        };
                $(window).load(function(){
					var urlSet=document.URL.split("pages/");
					localStorage.setItem("UrlStorage", urlSet[1]);
					var scrollAmt=localStorage.getItem("scrollAmount");
              if(localStorage.getItem("EscrollOff")=="true"){
                
                $("body").mCustomScrollbar({
                    theme:"minimal",
                    mouseWheel:{ scrollAmount: scrollAmt }
                });
                scrollBody();  
			  }
            });
             if(localStorage.getItem("EscrollOff")=="true"){
            $(window).on('hashchange', function(e){
                 scrollBody();
            });
			 }
            })(jQuery);
        </script>
    </body>

</html>
